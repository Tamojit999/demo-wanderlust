<% layout('./layouts/boilerplate') -%>
<body>
  <div class="checkout-container">
    <div class="checkout-card">
      <h2 class="listing-title"><%= listing.title %></h2>
      <p class="listing-amount">Amount: <strong>â‚¹<%= totalPrice %></strong></p>
      <button id="payBtn" class="pay-btn">Pay Now</button>
      <p class="footer-text">Secure payment powered by Razorpay</p>
    </div>
  </div>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    const payBtn = document.getElementById('payBtn');
    payBtn.addEventListener('click', () => {
      const options = {
        key: "<%= key %>",
        amount: "<%= totalPrice * 100 %>", // Razorpay expects amount in paise (number, not string)
        currency: "<%= order.currency %>",
        name: "<%= listing.title %>",
        description: "Payment for listing",
        order_id: "<%= order.id %>",
        callback_url: '/listings/<%= listing._id %>/payment-verification',
        theme: {
          color: '#FF5A5F',
        },
      };
      var rzp = new Razorpay(options);
      rzp.open();
    });
  </script>
</body>
